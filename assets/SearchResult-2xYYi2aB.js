import{u as O,h as se,i as te,j as U,k as le,l as ae,t as ie,m as re,n as A,p as R,q as ue,w as W,v as t,x as oe,R as _,y as ne,z as ce,A as me,B as ve,C as pe,D as he,E as de,F as ye,G as ge,H as S,I as fe,J as we,K as He,L as I,M,N as ke}from"./app-BMsVCMnT.js";const xe=["/","/intro.html","/posts/ensp-win11.html","/posts/git.html","/posts/linux-cmd.html","/posts/nodejs.html","/posts/vmware-macOS.html","/posts/algo/sieve.html","/posts/cpp/c-union.html","/posts/cpp/compile-time-obf.html","/posts/cpp/meta-program.html","/posts/hdoj/1010.html","/posts/rust/difficulties.html","/posts/rust/tricks.html","/posts/wsl/WSL-memo.html","/posts/wsl/docker-in-WSL.html","/posts/wsl/kali-linux-in-WSL.html","/posts/wsl/kali-wsl-autostart.html","/404.html","/posts/","/posts/algo/","/posts/cpp/","/posts/hdoj/","/posts/rust/","/posts/wsl/","/category/","/category/ensp/","/category/git/","/category/linux/","/category/nodejs/","/category/%E8%99%9A%E6%8B%9F%E6%9C%BA/","/category/luogu/","/category/c/","/category/c__/","/category/hdoj/","/category/rust/","/category/wsl/","/tag/","/tag/ensp/","/tag/win11/","/tag/virtualbox/","/tag/git/","/tag/linux/","/tag/vmware/","/tag/algorithm/","/tag/cpp/","/tag/c/","/tag/c__/","/tag/metaprogramming/","/tag/string-obfuscation/","/tag/bfs/","/tag/dfs/","/tag/data-structure/","/tag/wsl/","/tag/armoury-crate/","/article/","/star/","/timeline/"],Re="SLIMSEARCH_QUERY_HISTORY",y=O(Re,[]),Se=()=>{const{queryHistoryCount:l}=S,a=l>0;return{enabled:a,queryHistories:y,addQueryHistory:i=>{a&&(y.value=Array.from(new Set([i,...y.value.slice(0,l-1)])))},removeQueryHistory:i=>{y.value=[...y.value.slice(0,i),...y.value.slice(i+1)]}}},D=l=>xe[l.id]+("anchor"in l?`#${l.anchor}`:""),Qe="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:B}=S,g=O(Qe,[]),qe=()=>{const l=B>0;return{enabled:l,resultHistories:g,addResultHistory:a=>{if(l){const i={link:D(a),display:a.display};"header"in a&&(i.header=a.header),g.value=[i,...g.value.slice(0,B-1)]}},removeResultHistory:a=>{g.value=[...g.value.slice(0,a),...g.value.slice(a+1)]}}},Ce=l=>{const a=ve(),i=U(),Q=pe(),u=A(0),w=R(()=>u.value>0),h=he([]);return de(()=>{const{search:d,terminate:q}=ye(),f=ge(n=>{const{resultsFilter:H=o=>o,querySplitter:j,suggestionsFilter:C,...L}=a.value;n?(u.value+=1,d(n,i.value,L).then(o=>H(o,n,i.value,Q.value)).then(o=>{u.value-=1,h.value=o}).catch(o=>{console.warn(o),u.value-=1,u.value||(h.value=[])})):h.value=[]},S.searchDelay-S.suggestDelay,{maxWait:5e3});W([l,i],([n])=>{f(n.join(" "))},{immediate:!0}),fe(()=>{q()})}),{isSearching:w,results:h}};var be=se({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(l,{emit:a}){const i=te(),Q=U(),u=le(ae),{enabled:w,addQueryHistory:h,queryHistories:d,removeQueryHistory:q}=Se(),{enabled:f,resultHistories:n,addResultHistory:H,removeResultHistory:j}=qe(),C=w||f,L=ie(l,"queries"),{results:o,isSearching:P}=Ce(L),r=re({isQuery:!0,index:0}),v=A(0),p=A(0),F=R(()=>C&&(d.value.length>0||n.value.length>0)),b=R(()=>o.value.length>0),$=R(()=>o.value[v.value]||null),Y=()=>{const{isQuery:e,index:s}=r;s===0?(r.isQuery=!e,r.index=e?n.value.length-1:d.value.length-1):r.index=s-1},z=()=>{const{isQuery:e,index:s}=r;s===(e?d.value.length-1:n.value.length-1)?(r.isQuery=!e,r.index=0):r.index=s+1},G=()=>{v.value=v.value>0?v.value-1:o.value.length-1,p.value=$.value.contents.length-1},J=()=>{v.value=v.value<o.value.length-1?v.value+1:0,p.value=0},K=()=>{p.value<$.value.contents.length-1?p.value+=1:J()},N=()=>{p.value>0?p.value-=1:G()},E=e=>e.map(s=>ke(s)?s:t(s[0],s[1])),V=e=>{if(e.type==="customField"){const s=we[e.index]||"$content",[c,x=""]=He(s)?s[Q.value].split("$content"):s.split("$content");return e.display.map(m=>t("div",E([c,...m,x])))}return e.display.map(s=>t("div",E(s)))},k=()=>{v.value=0,p.value=0,a("updateQuery",""),a("close")},X=()=>w?t("ul",{class:"slimsearch-result-list"},t("li",{class:"slimsearch-result-list-item"},[t("div",{class:"slimsearch-result-title"},u.value.queryHistory),d.value.map((e,s)=>t("div",{class:["slimsearch-result-item",{active:r.isQuery&&r.index===s}],onClick:()=>{a("updateQuery",e)}},[t(I,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},e),t("button",{class:"slimsearch-remove-icon",innerHTML:M,onClick:c=>{c.preventDefault(),c.stopPropagation(),q(s)}})]))])):null,Z=()=>f?t("ul",{class:"slimsearch-result-list"},t("li",{class:"slimsearch-result-list-item"},[t("div",{class:"slimsearch-result-title"},u.value.resultHistory),n.value.map((e,s)=>t(_,{to:e.link,class:["slimsearch-result-item",{active:!r.isQuery&&r.index===s}],onClick:()=>{k()}},()=>[t(I,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},[e.header?t("div",{class:"content-header"},e.header):null,t("div",e.display.map(c=>E(c)).flat())]),t("button",{class:"slimsearch-remove-icon",innerHTML:M,onClick:c=>{c.preventDefault(),c.stopPropagation(),j(s)}})]))])):null;return ue("keydown",e=>{if(l.isFocusing){if(b.value){if(e.key==="ArrowUp")N();else if(e.key==="ArrowDown")K();else if(e.key==="Enter"){const s=$.value.contents[p.value];h(l.queries.join(" ")),H(s),i.push(D(s)),k()}}else if(f){if(e.key==="ArrowUp")Y();else if(e.key==="ArrowDown")z();else if(e.key==="Enter"){const{index:s}=r;r.isQuery?(a("updateQuery",d.value[s]),e.preventDefault()):(i.push(n.value[s].link),k())}}}}),W([v,p],()=>{var e;(e=document.querySelector(".slimsearch-result-list-item.active .slimsearch-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>t("div",{class:["slimsearch-result-wrapper",{empty:l.queries.length?!b.value:!F.value}],id:"slimsearch-results"},l.queries.length?P.value?t(oe,{hint:u.value.searching}):b.value?t("ul",{class:"slimsearch-result-list"},o.value.map(({title:e,contents:s},c)=>{const x=v.value===c;return t("li",{class:["slimsearch-result-list-item",{active:x}]},[t("div",{class:"slimsearch-result-title"},e||u.value.defaultTitle),s.map((m,ee)=>{const T=x&&p.value===ee;return t(_,{to:D(m),class:["slimsearch-result-item",{active:T,"aria-selected":T}],onClick:()=>{h(l.queries.join(" ")),H(m),k()}},()=>[m.type==="text"?null:t(m.type==="title"?ne:m.type==="heading"?ce:me,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},[m.type==="text"&&m.header?t("div",{class:"content-header"},m.header):null,t("div",V(m))])])})])})):u.value.emptyResult:C?F.value?[X(),Z()]:u.value.emptyHistory:u.value.emptyResult)}});export{be as default};
